!function(doc,Util,stringTools){"use strict";function FormValidator(e){var t=this;if(!e&&!e.container)throw new Error("请传入容器id");"string"==typeof e?(t.container=Util.selector(e),t=Util.extend(t,defaultSetting)):"object"==typeof e&&(t.container=Util.selector(e.container),t=Util.extend(t,defaultSetting,e)),t.serializeArray=t._serialize(t.tag)}var compatible={idcard:stringTools.idcard.validate,num:stringTools.isNum,phone:stringTools.isPhoneNum,tel:stringTools.isTelNum,email:stringTools.isEmail,externalUrl:stringTools.isExternalUrl},defaultSetting={tag:"input",isShowErr:!0,isDebug:!1,message:{requiredMsg:"未满足非空判断",minLenMsg:"未满足最小长度验证",maxLenMsg:"未满足最大长度验证",idcardMsg:"身份证号码验证不正确"}};FormValidator.prototype={validate:function(){return this._resolveRule(this.serializeArray)},getData:function(){return this._resolveJSON(this.serializeArray)},getError:function(){return this.errMsg},_serialize:function(e,t){return e=e||t,[].slice.call(this.container.querySelectorAll(e))},_resolveRule:function(e){var t=0,r=e.length,a=this,i=null;for(a.errMsg={};t<r;t++){if(i=e[t],i.required&&!a.isRequired(i))return!1;if((i.getAttribute("minlength")||i.getAttribute("maxlength"))&&!a._resolveMaxMin(i))return!1;if(i.dataset.ruleRegtype&&!a._resolveRegType(i))return!1;if(i.dataset.ruleRegexp&&!a._resolveRegExp(i))return!1;if(i.dataset.ruleMate&&!a._resolveMate(i))return!1}return!0},_resolveJSON:function(e){for(var t=0,r=e.length,a={};t<r;t++){var i=e[t],s=i.name;s&&(a[s]=i.value)}return a},isRequired:function(e){var t=e.value;return""!=t&&0!=t.length||(this.errMsg={message:this.message.requiredMsg,dom:e,data:e.value},this.toast(e),!1)},_resolveMaxMin:function(e){var t=e.maxLength,r=e.minLength,a=e.value,i=this;if(r&&!(a.length>=r)){var s=i.message.minLenMsg;return i.errMsg={message:s,dom:e,data:e.value},i.toast(e),i.debug(s),!1}if(t&&!(a.length<=t)){var n=i.message.maxLenMsg;return i.errMsg={message:n,dom:e,data:e.value},i.toast(e),i.debug(n),!1}return!0},_resolveRegType:function(e){var t=e.dataset.ruleRegtype,r=this;if(e.required||e.value.length>0){if("idcard"==t){var a=r.message.idcardMsg;return!!compatible.idcard(e.value)||(r.errMsg={message:a,dom:e,data:e.value},r.toast(e),r.debug(a),!1)}if(compatible[t])return!!compatible[t](e.value)||(r.errMsg={message:"输入内容未满足正则匹配"+t,dom:e,data:e.value},r.toast(e),r.debug("输入内容未满足正则匹配"+t),!1);throw new Error("该正则类型非所属类型，详见在线文档")}return!0},_resolveRegExp:function(dom){var regExp=dom.dataset.ruleRegexp,self=this;if(dom.required||dom.value.length>0){try{regExp=eval(regExp)}catch(e){throw new Error("自定义正则表达式有误")}return!!regExp.test(dom.value)||(self.errMsg={message:"输入内容未满足正则匹配",dom:dom,data:dom.value},self.toast(dom),self.debug("输入内容未满足正则匹配"),!1)}return!0},_resolveMate:function(e){for(var t=this,r=e.dataset.ruleMate,a=e.value,i=t._serialize("input[name='"+r+"']"),s=0,n=i.length;s<n;s++){var o=i[s];if(o.value!=a)return t.errMsg={message:"输入内容不一致",dom:o,data:o.value},t.toast(e),t.debug("输入内容不一致"),!1}return!0},toast:function(e){if(this.isShowErr){var t=e.dataset.ruleErrmsg||e.dataset.ruleMatemsg;Util.ejs.ui.toast(t||e.placeholder||"")}},debug:function(e){this.isDebug&&console.log(e)}},Util.form={getInstance:function(e){return new FormValidator(e)}}}(document,window.Util,window.Util.string);