!function(){"use strict";function i(i){i=Util.extend({},e,i),this.container=Util.selector(i.container),this._initData(i)}function t(i){if(!i)throw new Error("错误，数据为空！");for(var e=i.length,r=[],a=0;a<e;a++){var n=i[a];Array.isArray(n)?r[a]=t(n):r[a]={id:n.guid||n.id,title:n.title,url:n.pic||n.url}}return r}var e={container:"#gallery",isLoop:!0,isAuto:!1,autoTime:3e3,perLineItem:2,maxImgHeight:"100%",minImgHeight:null,isShowIndicator:!0,isShowPageIndicator:!1};i.prototype={_initData:function(i){if(i.data=i.data||[],this.options=i,!this._validate())throw new Error("验证错误，图片轮播的传入格式非法，请检查代码");this._render(),this._addEvent(),this._dealUrl()},_dealUrl:function(){var i=this,t=this.options;if(t.url){t.success=function(e){var r;r=t.dataChange?t.dataChange(e):Util.dataProcess(e,{dataPath:"custom.gallery"}).data,r&&(t.data=r,i._render(),i._addEvent())};var e=Util.extend({},t);e.data=e.dataRequest,Util.ajax(e)}},_validate:function(){var i=this.options.data,t=!0;return this.container?i&&Array.isArray(i)||(t=!1):t=!1,t},_render:function(){this.options.data=t(this.options.data);var i=this.container,e=this._renderGenHtml(),r=Util.parseHtml(e);i.innerHTML="",r&&i.appendChild(r)},_renderGenHtml:function(){var i=this.options,t=i.data,e=t.length,r="",a=function(t,e){var r="";r+=e?'<div class="mui-slider-item mui-slider-item-duplicate" >':'<div class="mui-slider-item">';var a=t.id?"id="+t.id:"",n=i.maxImgHeight?"max-height:"+i.maxImgHeight+";":"",s=i.minImgHeight?"min-height:"+i.minImgHeight+";":"";return r+='<a class="slider-img-item"'+a+">",r+='<img src="'+t.url+'" style="'+n+s+'">',t.title&&(r+='<p class="mui-slider-title">'+t.title+"</p>"),r+="</a>",r+="</div>"},n=function(t,e){var r="";r+=e?'<div class="mui-slider-item mui-slider-item-duplicate" >':'<div class="mui-slider-item">',r+='<ul class="mui-table-view mui-grid-view">';for(var a=t.length,n="mui-col-xs-"+12/i.perLineItem,s=0;s<a;s++){var l=t[s].id?"id="+t[s].id:"",d=i.maxImgHeight?"max-height:"+i.maxImgHeight+";":"",o=i.minImgHeight?"min-height:"+i.minImgHeight+";":"";r+=' <li class="mui-table-view-cell mui-media slider-img-item '+n+'" '+l+">",r+="<a> ",r+='<img class="mui-media-object" src="'+t[s].url+'" style="'+d+o+'">',t[s].title&&(r+='<div class="mui-media-body">'+t[s].title+"</div>"),r+="</a>",r+="</li>"}return r+="</ul>",r+="</div>"};if(r+='<div class="mui-slider">',r+=i.isLoop?'<div class="mui-slider-group mui-slider-loop">':'<div class="mui-slider-group">',i.isLoop){var s=e-1;Array.isArray(t[s])?r+=n(t[s],!0):t[s]&&(r+=a(t[s],!0))}for(var l=0;l<e;l++)Array.isArray(t[l])?r+=n(t[l],!1):t[s]&&(r+=a(t[l],!1));if(i.isLoop){var s=0;Array.isArray(t[s])?r+=n(t[s],!0):t[s]&&(r+=a(t[s],!0))}if(r+="</div>",i.isShowIndicator){r+='<div class="mui-slider-indicator">';for(var l=0;l<e;l++)r+=0==l?'<div class="mui-indicator mui-active"></div>':'<div class = "mui-indicator"></div>';r+="</div>"}return i.isShowPageIndicator&&(r+='<div class="mui-slider-indicator">',r+='<span class="mui-action mui-action-previous mui-icon mui-icon-back"></span>',r+='<div class="mui-number">',r+='<span id="curr-gallery-index">1</span> / <span id="gallery-length">'+e+"</span>",r+="</div>",r+='<span class="mui-action mui-action-next mui-icon mui-icon-forward"></span>',r+="</div>"),r+="</div>"},_addEvent:function(){var i=this.container,t=this.options,e=t.itemClick,r=mui(i),a=t.autoTime;t.isAuto||(a=0),r.slider({interval:a}),mui(i).off(),mui(i).on("tap",".slider-img-item",function(i){var t=this.getAttribute("id");return i.preventDefault(),e&&e(i,t),!1}),t.isShowIndicator&&mui(i).on("tap",".mui-slider-indicator .mui-indicator",function(i){var t=[].indexOf.call(this.parentNode.childNodes,this);return r.slider().gotoItem(t),i.preventDefault(),!1}),t.isShowPageIndicator&&(mui(i).on("tap",".mui-slider-indicator .mui-action-previous",function(i){return r.slider().prevItem(),i.preventDefault(),!1}),mui(i).on("tap",".mui-slider-indicator .mui-action-next",function(i){return r.slider().nextItem(),i.preventDefault(),!1})),this.gallery=r},update:function(i){i=Util.extend({},this.options,i),this._initData(i)},gotoItem:function(i,t){this.gallery&&this.gallery.slider().gotoItem(i,t)},nextItem:function(){this.gallery&&this.gallery.slider().nextItem()},prevItem:function(){this.gallery&&this.gallery.slider().prevItem()},getSlideNumber:function(){return this.gallery&&this.gallery.slider().getSlideNumber()},destroy:function(){return this.gallery&&this.gallery.slider().destroy(),mui(container).off(),null}},window.Gallery=i}();