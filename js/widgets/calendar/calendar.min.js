!function(){"use strict";function t(t){t=mui.extend({},n,t),this.container=this._selector(t.container),this._initData(t)}var n={container:"#calendar",isLunar:!0,isSwipeH:!0,isSwipeV:!0};t.prototype={_initData:function(t){if(this.options=t,!this._validate())throw new Error("验证错误，日历的传入格式非法，请检查代码");this._initParams(),this._addEvent()},_initParams:function(){var t=this;t.newDate=new Date,t.nowYear=t.newDate.getFullYear(),t.nowMonth=t.newDate.getMonth()+1,t.nowDay=t.newDate.getDate(),t.nowMonth=String(t.nowMonth),1==t.nowMonth.length&&(t.nowMonth="0"+t.nowMonth),t.CalendarData=new Array(100),t.madd=new Array(12),t.tgString="甲乙丙丁戊己庚辛壬癸",t.dzString="子丑寅卯辰巳午未申酉戌亥",t.numString="一二三四五六七八九十",t.monString="正二三四五六七八九十冬腊",t.weekString="日一二三四五六",t.sx="鼠牛虎兔龙蛇马羊猴鸡狗猪",t.cYear,t.cMonth,t.cDay,t.TheDate,t.CalendarData=new Array(2635,333387,1701,1748,267701,694,2391,133423,1175,396438,3402,3749,331177,1453,694,201326,2350,465197,3221,3402,400202,2901,1386,267611,605,2349,137515,2709,464533,1738,2901,330421,1242,2651,199255,1323,529706,3733,1706,398762,2741,1206,267438,2647,1318,204070,3477,461653,1386,2413,330077,1197,2637,268877,3365,531109,2900,2922,398042,2395,1179,267415,2635,661067,1701,1748,398772,2742,2391,330031,1175,1611,200010,3749,527717,1452,2742,332397,2350,3222,268949,3402,3493,133973,1386,464219,605,2349,334123,2709,2890,267946,2773,592565,1210,2651,395863,1323,2707,265877),t.madd[0]=0,t.madd[1]=31,t.madd[2]=59,t.madd[3]=90,t.madd[4]=120,t.madd[5]=151,t.madd[6]=181,t.madd[7]=212,t.madd[8]=243,t.madd[9]=273,t.madd[10]=304,t.madd[11]=334,this.refresh(t.nowYear,t.nowMonth,t.nowDay)},refresh:function(t,n,a){var e=this;e.nowYear=parseInt(t),e.nowMonth=parseInt(n),e.nowDay=parseInt(a),parseInt(e.nowMonth)>9?e.nowMonth=""+parseInt(e.nowMonth):e.nowMonth="0"+parseInt(e.nowMonth),parseInt(e.nowDay)>9?e.nowDay=""+parseInt(e.nowDay):e.nowDay="0"+parseInt(e.nowDay);var o=new Date(Date.parse(e.nowYear+"/"+e.nowMonth+"/1")),r=o.getDay();r=parseInt(r),0==r&&(r=7);var i=this._judgeDaysByYearMonth(e.nowYear,e.nowMonth),s={},h=this._judgeDaysByYearMonth(e.nowYear,e.nowMonth-1);h=parseInt(h);for(var d=r;d>0;d--){var w=h--,p="day"+d,c="lunar"+d;s[p]=w,s[c]=this._getLunar(w,"m-1")}var u=0;if("28"==i){u=28+r;for(var d=r+1,D=1;d<28+r+1;d++,D++){var p="day"+d,c="lunar"+d;s[p]=D,s[c]=this._getLunar(D)}}if("29"==i){u=29+r;for(var d=r+1,D=1;d<29+r+1;d++,D++){var p="day"+d,c="lunar"+d;s[p]=D,s[c]=this._getLunar(D)}}if("30"==i){u=30+r;for(var d=r+1,D=1;d<30+r+1;d++,D++){var p="day"+d,c="lunar"+d;s[p]=D,s[c]=this._getLunar(D)}}if("31"==i){u=31+r;for(var d=r+1,D=1;d<31+r+1;d++,D++){var p="day"+d,c="lunar"+d;s[p]=D,s[c]=this._getLunar(D)}}for(var l=u+1,y=1;l<=42;l++,y++){var p="day"+l,c="lunar"+l;s[p]=y,s[c]=this._getLunar(y,"m+1")}this._render(s)},_render:function(t){for(var n=this,a=[],e=1;e<43;e++)a.push({day_index:"{{day"+e+"}}",lunar_index:"{{lunar"+e+"}}"});var o="";o+='<table id="dateBorder">',o+="<tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr>";for(var r=1;r<7;r++){o+="<tr>";for(var i='<td><div class="dateQuan">{{day_index}}<span class="font12">{{lunar_index}}</span></div></td>',s="",h=7;h>0;h--){var d=7*r-h+1;s+=Mustache.render(i,a[d-1])}o+=s,o+="</tr>"}o+="</table>";var s=Mustache.render(o,t);this._selector(this.options.container).innerHTML=s;for(var w=0;w<=41&&1!=parseInt(Zepto("td")[w].innerText);w++)Zepto(Zepto("td")[w]).css("color","#D8D8D8"),Zepto(Zepto("td")[w]).find("div.dateQuan").addClass("nouse");for(var p=41;p>=0;p--){if(1==parseInt(Zepto("td")[p].innerText)){Zepto(Zepto("td")[p]).css("color","#D8D8D8"),Zepto(Zepto("td")[p]).find("div.dateQuan").addClass("nouse");break}Zepto(Zepto("td")[p]).css("color","#D8D8D8"),Zepto(Zepto("td")[p]).find("div.dateQuan").addClass("nouse")}var c=new Date,u=c.getFullYear(),D=c.getMonth()+1;u==n.nowYear&&D==n.nowMonth&&Zepto(".dateQuan").each(function(){if(Zepto(this).hasClass("nouse"));else{var t=Zepto(this).text();n.nowDay==parseInt(t)&&(Zepto(".dateQuan").removeClass("clickActive"),Zepto(this).addClass("clickActive").html("今天<span class='font12'>"+t.substr(-2,2)+"<span>"))}})},_addEvent:function(){var t=this,n=t.options.itemClick,a=t.options.swipeCallback;mui(t.options.container).on("tap",".dateQuan",function(){var a=this.querySelector(".font12").innerText.trim();if(Zepto(this).hasClass("nouse"));else{Zepto(".dateQuan").removeClass("clickActive"),Zepto(this).addClass("clickActive");var e=Zepto(this).text();e=parseInt(e)>9?""+parseInt(e):"0"+parseInt(e);var o=t.nowYear+"-"+t.nowMonth+"-"+e;n&&n({date:o,lunar:a})}}),t.options.isSwipeH&&(t._selector(t.options.container).addEventListener("swiperight",function(){t.options.isDebug&&console.log("你正在向右滑动"),t.nowMonth=parseInt(t.nowMonth)-parseInt(1),0==t.nowMonth&&(t.nowYear=t.nowYear-1,t.nowMonth=12),parseInt(t.nowMonth)>9?t.nowMonth=""+parseInt(t.nowMonth):t.nowMonth="0"+parseInt(t.nowMonth),parseInt(t.nowDay)>9?t.nowDay=""+parseInt(t.nowDay):t.nowDay="0"+parseInt(t.nowDay),t.refresh(t.nowYear,t.nowMonth,t.nowDay),a&&a({year:t.nowYear,month:t.nowMonth,day:t.nowDay})}),t._selector(t.options.container).addEventListener("swipeleft",function(){t.options.isDebug&&console.log("你正在向左滑动"),t.nowMonth=parseInt(t.nowMonth)+parseInt(1),13==t.nowMonth&&(t.nowYear=t.nowYear+1,t.nowMonth=1),parseInt(t.nowMonth)>9?t.nowMonth=""+parseInt(t.nowMonth):t.nowMonth="0"+parseInt(t.nowMonth),parseInt(t.nowDay)>9?t.nowDay=""+parseInt(t.nowDay):t.nowDay="0"+parseInt(t.nowDay),t.refresh(t.nowYear,t.nowMonth,t.nowDay),a&&a({year:t.nowYear,month:t.nowMonth,day:t.nowDay})})),t.options.isSwipeV},_getLunar:function(t,n){var a=this,e=a.nowYear,o=a.nowMonth;o=parseInt(o),"m+1"===n&&(o=1+o,13==o&&(o=1)),"m-1"===n&&(o=-1+o,0==o&&(o=1));var r=t;new Date(Date.parse(e+"/"+o+"/"+r)).getDay();return this._getLunarDay(e,o,r)},_judgeDaysByYearMonth:function(t,n){var a=this;if(void 0==t||null==t)throw"=====获取当前月份天数时，缺少y参数，未定义！=======";if(void 0==n||null==n)throw"=====获取当前月份天数时，缺少m参数，未定义！=======";var t=parseInt(t),n=parseInt(n);return 0==n&&(t--,n=12),2==n?t%4==0&&t%100!=0||t%400==0?"29":"28":a._inArray(n,[1,3,5,7,8,10,12])?"31":"30"},_validate:function(){var t=!0;return this.options.container||(t=!1),t},_selector:function(t){return document.querySelector(t)},_inArray:function(t,n){if(!Array.isArray(n))throw"arguments is not Array";for(var a=0,e=n.length;a<e;a++)if(t==n[a])return!0;return!1},_sibling:function(t,n){for(var a=t.parentNode.firstChild;a;a=a.nextSibling)1===a.nodeType&&a!==t&&n&&"function"==typeof n&&n(a)},_getBit:function(t,n){return t>>n&1},_e2c:function(){var t=this;t.TheDate=3!=arguments.length?new Date:new Date(arguments[0],arguments[1],arguments[2]);var n,a,e,o,r=!1,i=t.TheDate.getYear();for(i<1900&&(i+=1900),n=365*(i-1921)+Math.floor((i-1921)/4)+t.madd[t.TheDate.getMonth()]+t.TheDate.getDate()-38,t.TheDate.getYear()%4==0&&t.TheDate.getMonth()>1&&n++,a=0;;a++){for(o=t.CalendarData[a]<4095?11:12,e=o;e>=0;e--){if(n<=29+t._getBit(t.CalendarData[a],e)){r=!0;break}n=n-29-t._getBit(t.CalendarData[a],e)}if(r)break}t.cYear=1921+a,t.cMonth=o-e+1,t.cDay=n,12==o&&(t.cMonth==Math.floor(t.CalendarData[a]/65536)+1&&(t.cMonth=1-t.cMonth),t.cMonth>Math.floor(t.CalendarData[a]/65536)+1&&t.cMonth--)},_getcDateString:function(){var t=this,n="";return t.cMonth<1,n+=t.cDay<11?"初":t.cDay<20?"十":t.cDay<30?"廿":"三十",t.cDay%10==0&&10!=t.cDay||(n+=t.numString.charAt((t.cDay-1)%10)),n},_getLunarDay:function(t,n,a){var e=this;return t<1921||t>2080?"":(n=parseInt(n)>0?n-1:11,e._e2c(t,n,a),e._getcDateString())}},window.Calendar=t}();