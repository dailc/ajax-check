!function(){"use strict";function t(t){t=Util.extend({},e,t),this.container=Util.selector(t.container),this._initData(t)}var e={container:"#indexlist"};t.prototype={_initData:function(t){if(t.data=t.data||[],this.options=t,!this._validate())throw new Error("验证错误，索引列表的传入格式非法，请检查代码");this._render(),this._addEvent(),this._dealUrl()},_render:function(){this._selector("body").style.height="100%",this._selector("html").style.height="100%";var t=this._getTemplate();this._selector(this.options.container).innerHTML=t;var e=this.options.data,i=this._renderGenHtml(e);this._selector("#indexedListData").innerHTML=i;var a=this._selector("#indexedList");a.style.height=document.body.offsetHeight+"px",new mui.IndexedList(a)},_addEvent:function(){var t=this.options.itemClick;mui(this.options.container).on("tap","li",function(e){if(this.classList.contains("mui-indexed-list-item")){var i={text:this.innerText,value:this.id};t&&t.call(this,i)}})},_dealUrl:function(){var t=this,e=this.options;if(e.url){e.success=function(i){var a;a=e.dataChange?e.dataChange(i):Util.dataProcess(i,{dataPath:["custom.infolist","custom.infoList"]}).data,a&&(e.data=a,t._render())};var i=Util.extend({},e);i.data=i.dataRequest,Util.ajax(i)}},_getTemplate:function(){var t='<div id="indexedList" class="mui-indexed-list">\t\t\t\t<div class="mui-indexed-list-search mui-input-row mui-search">\t\t\t\t\t<input type="search" class="mui-input-clear mui-indexed-list-search-input" placeholder="按字母搜索关键字">\t\t\t\t</div>\t\t\t\t<div class="mui-indexed-list-bar">\t\t\t\t\t<a>A</a>\t\t\t\t\t<a>B</a>\t\t\t\t\t<a>C</a>\t\t\t\t\t<a>D</a>\t\t\t\t\t<a>E</a>\t\t\t\t\t<a>F</a>\t\t\t\t\t<a>G</a>\t\t\t\t\t<a>H</a>\t\t\t\t\t<a>I</a>\t\t\t\t\t<a>J</a>\t\t\t\t\t<a>K</a>\t\t\t\t\t<a>L</a>\t\t\t\t\t<a>M</a>\t\t\t\t\t<a>N</a>\t\t\t\t\t<a>O</a>\t\t\t\t\t<a>P</a>\t\t\t\t\t<a>Q</a>\t\t\t\t\t<a>R</a>\t\t\t\t\t<a>S</a>\t\t\t\t\t<a>T</a>\t\t\t\t\t<a>U</a>\t\t\t\t\t<a>V</a>\t\t\t\t\t<a>W</a>\t\t\t\t\t<a>X</a>\t\t\t\t\t<a>Y</a>\t\t\t\t\t<a>Z</a>\t\t\t\t</div>\t\t\t\t<div class="mui-indexed-list-alert"></div>\t\t\t\t<div class="mui-indexed-list-inner">\t\t\t\t\t<div class="mui-indexed-list-empty-alert">没有数据</div>\t\t\t\t\t<ul class="mui-table-view community-list" id="indexedListData">\t\t\t\t\t</ul>\t\t\t\t</div>\t\t\t</div>';return t},_renderGenHtml:function(t){var e="";if(!t||!Array.isArray(t))throw new Error("传入data参数必须是JSON数组且不为空！");return mui.each(t,function(t,i){if(i.firstletter=i.firstletter.toUpperCase(),e+='<li data-group="'+i.firstletter+'" class="mui-table-view-divider mui-indexed-list-group">'+i.firstletter+"</li>",!i.category||!Array.isArray(i.category))throw new Error("传入IndexedList参数必须是数组且不为空！");var a='<li class="mui-table-view-cell mui-indexed-list-item" id="{{value}}">{{text}}</li>',n=i.category;mui.each(n,function(t,i){e+=Mustache.render(a,i)})}),e},_validate:function(){var t=this.options.data,e=!0;return this.container?t&&Array.isArray(t)||(e=!1):e=!1,e},_selector:function(t){return document.querySelector(t)}},window.IndexedList=t}(),function(t,e,i){var a=function(e){return"."+t.className(e)},n=t.IndexedList=t.Class.extend({init:function(t,e){var i=this;if(i.options=e||{},i.box=t,!i.box)throw"实例 IndexedList 时需要指定 element";i.createDom(),i.findElements(),i.caleLayout(),i.bindEvent()},createDom:function(){var t=this;t.el=t.el||{},t.el.styleForSearch=i.createElement("style"),(i.head||i.body).appendChild(t.el.styleForSearch)},findElements:function(){var t=this;t.el=t.el||{},t.el.search=t.box.querySelector(a("indexed-list-search")),t.el.searchInput=t.box.querySelector(a("indexed-list-search-input")),t.el.searchClear=t.box.querySelector(a("indexed-list-search")+" "+a("icon-clear")),t.el.bar=t.box.querySelector(a("indexed-list-bar")),t.el.barItems=[].slice.call(t.box.querySelectorAll(a("indexed-list-bar")+" a")),t.el.inner=t.box.querySelector(a("indexed-list-inner")),t.el.items=[].slice.call(t.box.querySelectorAll(a("indexed-list-item"))),t.el.liArray=[].slice.call(t.box.querySelectorAll(a("indexed-list-inner")+" li")),t.el.alert=t.box.querySelector(a("indexed-list-alert"))},caleLayout:function(){var t=this,e=t.box.offsetHeight-t.el.search.offsetHeight+"px";t.el.bar.style.height=e,t.el.inner.style.height=e;var i=(t.el.bar.offsetHeight-40)/t.el.barItems.length+"px";t.el.barItems.forEach(function(t){t.style.height=i,t.style.lineHeight=i})},scrollTo:function(t){var e=this,i=e.el.inner.querySelector('[data-group="'+t+'"]');!i||e.hiddenGroups&&e.hiddenGroups.indexOf(i)>-1||(e.el.inner.scrollTop=i.offsetTop)},bindBarEvent:function(){var e=this,a=null,n=function(t){a&&(a.classList.remove("active"),a=null),e.el.bar.classList.add("active");var n=t.changedTouches?t.changedTouches[0]:t;if(a=i.elementFromPoint(n.pageX,n.pageY)){var r=a.innerText;r&&1==r.length&&(a.classList.add("active"),e.el.alert.innerText=r,e.el.alert.classList.add("active"),e.scrollTo(r))}t.preventDefault()},r=function(t){e.el.alert.classList.remove("active"),e.el.bar.classList.remove("active"),a&&(a.classList.remove("active"),a=null)};e.el.bar.addEventListener(t.EVENT_MOVE,function(t){n(t)},!1),e.el.bar.addEventListener(t.EVENT_START,function(t){n(t)},!1),i.body.addEventListener(t.EVENT_END,function(t){r(t)},!1),i.body.addEventListener(t.EVENT_CANCEL,function(t){r(t)},!1)},search:function(e){var i=this;e=(e||"").toLowerCase();var n=[],r=-1,s=0,l=i.el.liArray,d=l.length;i.hiddenGroups=[];var o=function(t,e){s>=t-r-(e?0:1)&&(n.push(a("indexed-list-inner li")+":nth-child("+(r+1)+")"),i.hiddenGroups.push(l[r])),r=t,s=0};l.forEach(function(i){var r=l.indexOf(i);if(i.classList.contains(t.className("indexed-list-group")))o(r,!1);else{var c=(i.innerText||"").toLowerCase(),u=(i.getAttribute("data-value")||"").toLowerCase(),h=(i.getAttribute("data-tags")||"").toLowerCase();e&&c.indexOf(e)<0&&u.indexOf(e)<0&&h.indexOf(e)<0&&(n.push(a("indexed-list-inner li")+":nth-child("+(r+1)+")"),s++),r>=d-1&&o(r,!0)}}),n.length>=d?i.el.inner.classList.add("empty"):n.length>0?(i.el.inner.classList.remove("empty"),i.el.styleForSearch.innerText=n.join(", ")+"{display:none;}"):(i.el.inner.classList.remove("empty"),i.el.styleForSearch.innerText="")},bindSearchEvent:function(){var e=this;e.el.searchInput.addEventListener("input",function(){var t=this.value;e.search(t)},!1),t(e.el.search).on("tap",a("icon-clear"),function(){e.search("")},!1)},bindEvent:function(){var t=this;t.bindBarEvent(),t.bindSearchEvent()}});t.fn.indexedList=function(t){return this.each(function(e,i){i.indexedList||(i.indexedList=new n(i,t))}),this[0]?this[0].indexedList:null}}(mui,window,document);