!function(t){"use strict";function e(t,e,i){var n=function(){};if(n.prototype=e.prototype,t.prototype=new n,t.prototype.constructor=t,t["super"]=e.prototype,i)for(var o in i)t.prototype[o]=i[o]}function i(t,e){n[e]=t}var n={},o=function(t){var e,i=t.className,o=i.match(/ep-mui-\w*/g);return o.length>0&&(e=n[o[0]]),e||console.warn("没有对应的控件类型",t),e},s=function(t){this.el=t;var e=t.id;e||(e=epm.generateId(),t.id=e),this.id=e,this._init()};s.prototype={constructor:s,_init:function(){},value:"",getValue:function(){return this.value},setValue:function(t){this.value=t,void 0!==this.el.value?this.el.value=t:this.el.innerText=t},getModule:function(){return{id:this.id}},getAttribute:function(t){return this.el.getAttribute(t)}};var a=function(t){a["super"].constructor.call(this,t)};e(a,s,{type:"textbox",_init:function(){this.bind=this.getAttribute("bind");var t=this;this.el.addEventListener("change",function(e){t.value=t.el.value})},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,value:this.value}}}),i(a,"ep-mui-textbox");var r=function(t){r["super"].constructor.call(this,t)};e(r,a,{type:"textarea"}),i(r,"ep-mui-textarea");var u=function(t){u["super"].constructor.call(this,t)};e(u,s,{_init:function(){var t=this.getAttribute("data-options")||"{}",e=epm.parseJSON(t);e.beginDate&&(e.beginDate=new Date(e.beginDate)),e.endDate&&(e.endDate=new Date(e.endDate)),this.format=e.format||this.getAttribute("format")||"yyyy-MM-dd",this.bind=this.getAttribute("bind");var i=this;this.el.addEventListener("tap",function(){var t=new mui.DtPicker(e);t.show(function(e){i.setValue(e.text),t.dispose()})},!1)},type:"datepicker",getModule:function(){return{id:this.id,type:this.type,bind:this.bind,format:this.format,value:this.value}}}),i(u,"ep-mui-datepicker");var c=function(t){c["super"].constructor.call(this,t)};e(c,s,{_init:function(){var t=this.getAttribute("data-options")||"{}",e=epm.parseJSON(t),i={},n=this.getAttribute("data");e.buttons&&(i.buttons=e.buttons,delete e.buttons),this.options=e,this.bind=this.getAttribute("bind"),this.action=this.getAttribute("action");var o=this;this.picker=new mui.PopPicker(i),n&&(n=epm.parseJSON(n),this.setData(n)),this.el.addEventListener("tap",function(t){o.picker.show(function(t){o.setValue(t[0].value)})},!1),this.picker.body.addEventListener("change",function(t){var e=t.detail.item,i=e.text,n=e.value;o.setText(i),o.value=n})},type:"combobox",setText:function(t){this.el.innerText=t,this.text=t},getText:function(){return this.text},setValue:function(t){this.value=t,this.picker.pickers[0]&&this.picker.pickers[0].setSelectedValue(t)},setData:function(t){this.data=t,this.picker.setData(t)},getData:function(){return this.data},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,action:this.action,value:this.value,dataOptions:this.options}}}),i(c,"ep-mui-combobox");var l=function(t){l["super"].constructor.call(this,t)};e(l,s,{type:"radiobuttonlist",_init:function(){var t=this.getAttribute("data");this.bind=this.getAttribute("bind"),this.action=this.getAttribute("action"),t&&(t=epm.parseJSON(t),this.setData(t))},_templ:'<div class="mui-input-row mui-radio"><label>{{text}}</label><input type="radio" name="{{name}}" value="{{value}}" {{#checked}}checked="checked"{{/checked}}></div>',setData:function(t){for(var e=[],i=this.value,n=0,o=t.length;n<o;n++)i&&i===t[n].value&&(t[n].checked=!0),t[n].name=this.id,e.push(Mustache.render(this._templ,t[n]));this.el.innerHTML=e.join(""),this.radios=mui('input[type="radio"]',this.el);var s=this;this.radios.each(function(t,e){e.addEventListener("change",function(t){s.value=t.target.value})})},getData:function(){return this.data},setValue:function(t){if(this.value=t,this.radios)for(var e=this.radios,i=0,n=e.length;i<n;i++)if(e[i].value==t){e[i].checked=!0;break}},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,action:this.action,value:this.value}}}),i(l,"ep-mui-radiobuttonlist");var h=function(t){h["super"].constructor.call(this,t)};e(h,l,{type:"checkboxlist",_templ:'<div class="mui-input-row mui-checkbox"><label>{{text}}</label><input type="checkbox" value="{{value}}" {{#checked}}checked="checked"{{/checked}}></div>',setData:function(t){var e=[],i=this.value;i&&(i=","+i+",");for(var n=0,o=t.length;n<o;n++)i&&i.indexOf(","+t[n].value+",")>-1&&(t[n].checked=!0),e.push(Mustache.render(this._templ,t[n]));this.el.innerHTML=e.join(""),this.checkboxs=mui('input[type="checkbox"]',this.el);var s=this;this.checkboxs.each(function(t,e){e.addEventListener("change",function(t){var e,i=t.target;i.checked?(s.value&&(s.value+=","),s.value+=i.value):(e=","+s.value+",",e=e.replace(","+i.value+",",","),s.value=e.substr(1,e.length-2))})})},setValue:function(t){if(this.value=t,t=","+t+",",this.checkboxs)for(var e=this.checkboxs,i=0,n=e.length;i<n;i++)t.indexOf(e[i].value)>-1&&(e[i].checked=!0)}}),i(h,"ep-mui-checkboxlist");var d=function(t){d["super"].constructor.call(this,t)};e(d,s,{type:"outputtext",_init:function(){this.bind=this.getAttribute("bind"),this.options=this.getAttribute("data-options"),this.options&&(this.options=epm.parseJSON(this.options))},setValue:function(t){this.value=t,this.el.innerHTML=t},getModule:function(){return{id:this.id,type:this.type,bind:this.bind,dataOptions:this.options}}}),i(d,"ep-mui-outputtext");var p=function(t){p["super"].constructor.call(this,t)};e(p,s,{type:"datagrid",_init:function(){var t=this.el.children,e=this.getAttribute("fields"),i=this.getAttribute("onitemrender"),n=this.getAttribute("onitemclick");if(this.action=this.getAttribute("action"),this.url=this.getAttribute("url"),this.pageSize=parseInt(this.getAttribute("pageSize")),this.defaultPage=parseInt(this.getAttribute("defaultPage"))||0,this.extraId=this.getAttribute("extraId"),this.idField=this.getAttribute("idField"),this.columns=[],t[0]&&(t[0].id="{{"+this.idField+"}}",this.template=t[0].outerHTML.trim()),e){e=e.split(",");for(var o=0,s=e.length;o<s;o++)this.columns.push({fieldName:e[o]})}i&&"function"==typeof window[i]&&(this.onItemRender=window[i]);var a=this;if(n&&"function"==typeof window[n]?this.onItemClick=window[n]:window.addEventListener("DOMContentLoaded",function(){n&&"function"==typeof window[n]&&(a.onItemClick=window[n])}),this.el.innerHTML="",this.pageSize>0){var r=epm.closest(this.el,"mui-scroll-wrapper");r||(r=mui(".mui-content")[0],r&&r.classList.add("mui-scroll-wrapper")),r.id||(r.id=epm.generateId("pullrefresh")),this.scrollId=r.id;var u=document.createElement("div");u.className="mui-scroll",this.el.parentNode.replaceChild(u,this.el),u.appendChild(this.el),this.initPullRefresh()}},setData:function(t,e){for(var i,n=[],o=document.createElement("div"),s=0,a=t.length;s<a;s++)i=this.onItemRender?this.onItemRender.call(this,t[s]):Mustache.render(this.template,t[s]),e?n.push(i):(o.innerHTML=i,this.el.appendChild(o.childNodes[0]));e&&(this.el.innerHTML=n.join(""))},getData:function(){return this.data},setTotal:function(t){this.total=t},setUrl:function(t){this.url=t,this.pullToRefresh&&(this.pullToRefresh.options.url=t)},initPullRefresh:function(){var t=this,e=function(e){t.pageIndex=e;var i={};return t.onGetRequestData&&(i=t.onGetRequestData()),i},i=function(t){return t=epm.getSecondRequestData(t)},n=function(e,i){var n=e.total;e=e.data,t.setTotal(n),t.setData(e,i)},o=function(e){t.onItemClick&&t.onItemClick.call(this,e,this.id)},s=function(){t.pullToRefresh=new PullToRefreshTools.bizlogic({isDebug:!0,url:t.url||t.action,initPageIndex:t.defaultPage||0,template:t.template,dataRequest:e,itemClick:o,dataChange:i,success:n,isAutoRender:!1,contentType:"application/x-www-form-urlencoded",container:"#"+t.scrollId,listContainer:"#"+t.id,setting:{up:{auto:!1}}})};window.PullToRefreshTools?s():Util.loadJs("js/widgets/pulltorefresh/pulltorefresh.skin.default.js","js/widgets/pulltorefresh/pulltorefresh.bizlogic.impl.js",s)},getModule:function(){var t={id:this.id,type:this.type,action:this.action,columns:this.columns,idField:this.idField,isSecondRequest:!1};return this.pageSize>0&&(t.pageSize=this.pageSize,t.pageIndex=this.pageIndex),t}}),i(p,"ep-mui-list"),t.init=function(t){for(var e,i,n=document.querySelectorAll('[class^="ep-mui-"]'),s=0,a=n.length;s<a;s++)e=o(n[s]),e&&(i=new e(n[s]),epm.set(i.id,i),t&&t(i))}}(window.MControl={}),function(win,$){var epm={components:{},idIndex:0,generateId:function(t){return(t||"epm-")+this.idIndex++},get:function(t){return epm.components[t]||null},set:function(t,e){this.components[t]=e},mask:$.createMask(),showMask:function(){this.mask.show()},hideMask:function(){this.mask.close()},getSecondRequestData:function(t){var e=t.status;if(e){var i=parseInt(e.code),n=e.text,o=e.url;if(i>=300)return void(o?win.location.href=this.getRightUrl(o):$.alert(n,"提示","我知道了"))}return t.controls&&(t=t.controls[0]),t},getRootPath:function(){var t=window.location,e=t.hostname,i=t.protocol,n=t.port?":"+t.port:"",o=(void 0!==window._rootPath?_rootPath:"/"+t.pathname.split("/")[1])+"/",s=i+"//"+e+n+o;return s},getRightUrl:function(t){if(!t)return"";var e=t.indexOf("./")!=-1||t.indexOf("../")!=-1;return t=/^(http|https|ftp)/g.test(t)||e?t:this.getRootPath()+t},_pageLoagding:$("body>.page-loading"),hidePageLoading:function(){this._pageLoagding&&this._pageLoagding.length&&(document.body.removeChild(this._pageLoagding[0]),this._pageLoagding=void 0)},parseJSON:function(str){return eval("("+str+")")},closest:function(t,e){if(t&&e){var i=t.parentNode,n=i.className;return(" "+n+" ").indexOf(" "+e+" ")>=0?i:"BODY"===i.tagName?void 0:this.closest(i,e)}},getCookie:function(t){var e,i=new RegExp("(^| )"+t+"=([^;]*)(;|$)");return(e=document.cookie.match(i))?unescape(e[2]):null},extend:function(){var t,e,i,n,o,s,a=arguments[0]||{},r=1,u=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[r]||{},r++),"object"==typeof a||exports.isFunction(a)||(a={}),r===u&&(a=this,r--);r<u;r++)if(null!=(t=arguments[r]))for(e in t)i=a[e],n=t[e],a!==n&&(c&&n&&(exports.isPlainObject(n)||(o=exports.isArray(n)))?(o?(o=!1,s=i&&exports.isArray(i)?i:[]):s=i&&exports.isPlainObject(i)?i:{},a[e]=epm.extend(c,s,n)):void 0!==n&&(a[e]=n));return a},appendHtmlChildCustom:function(t,e){if("string"==typeof t&&(t=document.querySelector(t)),null!=t&&null!=e&&t instanceof HTMLElement)if(e instanceof HTMLElement)t.appendChild(e);else{var i=exports.pareseStringToHtml(e);null!=i&&t.appendChild(i)}},getChildElemLength:function(t){return t instanceof HTMLElement?t.children.length:0},isUseConfig:window.Config&&window.Config.comdto&&window.Config.comdto.isUseConfig,isRestFul:window.Config&&window.Config.comdto&&window.Config.comdto.isRestFul,isMock:window.Config&&window.Config.comdto&&window.Config.comdto.isMock,requestMethod:window.Config&&window.Config.comdto&&window.Config.comdto.requestMethod||"post"};epm.isUseConfig&&(epm.getRootPath=function(){return window.Config.comdto.rootUrl}),win.epm=epm}(window,mui),function(){"use strict";!function(){function t(t,e){t.indexOf(".")!=-1&&t.indexOf(".jspx")==-1&&(epm.isRestFul?t=t.replace(".","/"):t.indexOf("cmd=")<0&&(t=t.replace(".",".action?cmd=")));var i=window.location.href,n=i.indexOf("?"),o=t.indexOf("?")>-1;return n!=-1?(t+=o?"&"+i.substring(n+1):"?"+i.substring(n+1),e&&(t+="&isCommondto=true")):e&&(t+=o?"&isCommondto=true":"?isCommondto=true"),t=epm.getRightUrl(t)}MControl.init(function(t){"datagrid"==t.type&&(t.onGetRequestData=function(){var t=new e(this.id).getData(!0);if(t[0].isSecondRequest=!0,this.extraId)for(var i=this.extraId.split(","),n=0;n<i.length;n++)t=t.concat(new e(i[n]).getData(!0));return{commonDto:JSON.stringify(t)}})});var e=function(e,i,n,o){function s(t){var e=mui("#"+t);return e[0]&&/ep-mui-\w*/g.test(e[0].className)?e:mui('[class^="ep-mui-"]',e)}this.controls={},this.action=i,this.initHook=n;var a,r,u=this,c=[];if("@none"!=e)if(e&&"@all"!==e)if(Array.isArray(e))for(a=0,r=e.length;a<r;a++)c=c.concat(s(e[a]));else c=c.concat(s(e));else c=mui('[class^="ep-mui-"]');for(a=0,r=c.length;a<r;a++){var l=c[a],h=epm.get(l.id);h&&(u.controls[h.id]=h,o&&h.action&&h.setUrl&&h.setUrl(t(this.action+"."+h.action)))}};e.prototype={constructor:e,getData:function(t){var e,i,n,o=[];for(var s in this.controls)e=this.controls[s],i=e.getModule(),n=e.getAttribute("data-options"),n&&(i.dataOptions=epm.parseJSON(n)),o.push(i);return t?o:{commonDto:JSON.stringify(o)}},setData:function(t,e){for(var i,n,o,s=0,a=t.length;s<a;s++)o=t[s],i=o.id,n=this.controls[i],n&&(void 0!==o.value&&n.setValue&&n.setValue(o.value),o.data&&n.setData&&(n.setData(o.data),o.total&&n.setTotal&&n.setTotal(o.total)),this.initHook&&this.initHook.call(this,n,o,e))},init:function(t){var e=this,i=this.getData();t.params&&(i.cmdParams=t.params),t.notShowLoading||epm.showMask(),Util.ajax({url:t.url,type:epm.requestMethod,dataType:"json",contentType:"application/x-www-form-urlencoded;charset=UTF-8",data:i,beforeSend:function(t){var e=epm.getCookie("_CSRFCOOKIE");e&&t.setRequestHeader("CSRFCOOKIE",e)},success:function(i){var n=i.status,o=i.controls,s=i.custom||"",a=parseInt(n.code),r=n.text,u=n.url;if(a>=300){if(u)return u=epm.getRightUrl(u),void Util.ejs.alert("错误:"+JSON.stringify(n));t.fail?t.fail.call(e,r,n):Util.ejs.alert(r,"提示","我知道了")}else a>=200&&(o.length&&e.setData(o,s),t.done&&t.done.call(e,s))},complete:function(){t.notShowLoading||epm.hideMask()}})}};var i={initPage:function(i,n,o,s,a){var r;"object"==typeof s&&void 0===a&&(a=s,s=void 0),a=a||{},"function"==typeof a?(r=a,a={}):r=a.initHook;var u=i.split("?"),c=u[0],l=u[1],h=c.indexOf("."),d=h>0?c.substr(0,h):c;this.getCache("action")||(this.setCache("action",d),this.setCache("urlParam",l),this.setCache("callback",o)),epm.isMock||(h<0&&(c+=".page_Load"),i=c+(l?"?"+l:""));var p;n&&n.constructor===Object&&(p=n,n=void 0);var f=a.initControl;void 0===f&&(f=!0);var g=new e(n,d,r,f);g.init({url:epm.isMock?i:t(i,!0),method:a.method,params:p,done:function(t){o&&o.call(this,t),window.epoint_afterInit&&window.epoint_afterInit(t),epm.hidePageLoading()},fail:s})},refresh:function(t,e){var i=this.getCache("action")+".page_Refresh",n=this.getCache("urlParam");n&&(i+="?"+n),"function"==typeof t&&(e=t,t="@all"),e=e||this.getCache("callback"),this.initPage(i,t,e,{initControl:!1})},execute:function(i,n,o,s,a){var r,u=i.indexOf(".");epm.isMock||(u<0?(r=this.getCache("action"),i=r+"."+i):r=i.substr(0,u));var c=new e(n,r);"function"==typeof o&&(s=o,o=null),c.init({url:epm.isMock?i:t(i,!0),params:o?"string"==typeof o?o:mini.encode(o):null,done:s,notShowLoading:a})},validate:function(t){var e=Util.form.getInstance("#"+t);return e.validate()},alert:function(t,e,i){Util.ejs.alert(t,e,"我知道了",i)},confirm:function(t,e,i,n){Util.ejs.confirm(t,e,["确定","取消"],function(t){0===t&&i?i():n&&n()})},_cache:{},setCache:function(t,e){this._cache[t]=e},getCache:function(t){return this._cache[t]},delCache:function(t){this._cache[t]=null,delete this._cache[t]}};window.epointm=i}()}();